<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>良博贺新年</title>
    <link rel="stylesheet" href="css/screen1.css">
    <script src="js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="js/music.js"></script>
</head>

<body>
    <audio id='audio' autoplay="autoplay" src='audio/screen.mp3' loop></audio>
    <button id='status' onclick='triggerBgMusic()'></button>
    <img src="" class="music music_start">
    <img src="" class="music music_stop">
    <ul>
        <!-- <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li>
        <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li>
        <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li>
        <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li>
        <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li>
        <li>
            <div class="pic"> <img src="image/s_1.png" alt=""></div>
            <div class="content">
                <p class="nickname">微信网友：123</p>
                <p class="blessing">祝您在新的一年天天开心</p>
            </div>

        </li> -->

    </ul>
</body>
<script>
    $(function() {
        console.log(1);
        var i = 0;
        var j = 0;
        var timer = 'null';
        var picid = "null";
        var picSrc = "null";
        var newdata = 'null';

        function post() {
            $.post("https://wx.weibenh5.com/2020/Dec/yearCard/api/down.php?a=cardinfo", {
                    // a: cardinfo,
                },
                function(data, status) {
                    // console.log(data, status);
                    // console.log(data.data[0].content);
                    // console.log(data.data[i + 1].nickname);
                    // console.log("i+1", i + 1);
                    newdata = data;
                    picSrc = 'image/s_' +
                        parseInt(newdata.data[i].title / 10) +
                        '.png';
                    // console.log('里面', newdata);

                }

            )
        }
        post();
        setTimeout(function() {
            console.log('外面2s', picSrc)
        }, 1000);

        function getdetails() {
            $('ul').append("<li id=" + i +
                "><div class='pic'><img src='image/s_" +
                parseInt(newdata.data[i].title / 10) +
                ".png'></div><div class='content'><p class='nickname'>微信网友：" +
                newdata.data[i].nickname +
                "</p><p class='blessing'>" +
                newdata.data[i].content +
                "</p></div></li>");
            // $('ul').append("<li><div class='pic'><img src='" +
            //     picSrc+
            //     "'></div></li>");
            i += 1;
            console.log(i);
        };
        setTimeout(getdetails, 2000);
        setTimeout(getdetails, 2000);
        setTimeout(getdetails, 2000);
        setTimeout(getdetails, 2000);
        setTimeout(getdetails, 2000);
        setTimeout(getdetails, 2000);
        // console.log(newdata.data.length);
        setTimeout(setInterval(function Interval() {

            if (i >= 6) {
                $('ul').hide();
                $('li').eq(j - 6).remove();
                console.log('aa', i - 6);
            }
            if (i >= newdata.data.length) {
                i = 0;
                $('ul').children('li').remove();
                post();
                // $('ul').children('li').remove();
                setTimeout(getdetails, 2000);
                setTimeout(getdetails, 2000);
                setTimeout(getdetails, 2000);
                setTimeout(getdetails, 2000);
                setTimeout(getdetails, 2000);
                // setTimeout(getdetails, 2000);
            }
            setTimeout(getdetails, 2000);
            $('ul').fadeIn(7000)
        }, 10000), 2000);
        //     }
        // )
    })
</script>

<script>
    //----------页面初始化------------
    var audio = document.getElementById('audio');
    if (sessionStorage.bgmusic == 'pause') {
        playBgMusic(false);
    } else {
        playBgMusic(true);
        //----------处理自动播放------------
        //--创建页面监听，等待微信端页面加载完毕 触发音频播放
        document.addEventListener('DOMContentLoaded', function() {
            function audioAutoPlay() {
                playBgMusic(true);
                document.addEventListener("WeixinJSBridgeReady", function() {
                    playBgMusic(true);
                }, false);
            }
            audioAutoPlay();
        });
        //--创建触摸监听，当浏览器打开页面时，触摸屏幕触发事件，进行音频播放
        function audioAutoPlay() {
            playBgMusic(true);
            document.removeEventListener('touchstart', audioAutoPlay);
        }
        document.addEventListener('touchstart', audioAutoPlay);
    }
    //----------处理页面激活------------
    var hiddenProperty = 'hidden' in document ? 'hidden' :
        'webkitHidden' in document ? 'webkitHidden' :
        'mozHidden' in document ? 'mozHidden' :
        null;
    var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
    var onVisibilityChange = function() {
        if (!document[hiddenProperty]) {
            if (!sessionStorage.bgmusic || sessionStorage.bgmusic == 'play') {
                audio.play();
            }
        } else {
            audio.pause();
        }
    }
    document.addEventListener(visibilityChangeEvent, onVisibilityChange);
    //---------背景音乐开关----------
    function triggerBgMusic() {
        if (!sessionStorage.bgmusic || sessionStorage.bgmusic == 'play') {
            playBgMusic(false);
        } else {
            playBgMusic(true);
        }
    }
    //---------音乐播放和暂停----------
    function playBgMusic(val) {
        if (val) {
            audio.play();
            sessionStorage.bgmusic = 'play';
            document.getElementById('status').innerHTML = '正在播放';
            $(".music_stop").css("display", "none")
            $(".music_start").css("display", "block")
        } else {
            audio.pause();
            sessionStorage.bgmusic = 'pause';
            document.getElementById('status').innerHTML = '停止播放了';
            $(".music_start").css("display", "none")
            $(".music_stop").css("display", "block")
        }
    }
</script>
</html>