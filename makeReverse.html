<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimun-scale=1.0,maximum-scale=1.0,user-scable=no">
    <title>制作（背面）</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/makeReverse.css">
    <script src="js/jquery-3.5.1.min.js"></script>
</head>

<body>
    <h3><img src="image/zhizuoheka.png" alt=""></h3>
    <div>

        <div class="inherit">
            <div class="introduce">玉琮式管<br>反山M20：87<br>高3.47厘米
            </div>
            <img src="image/xa_1.png" alt="" class="cultural">
            <img src="image/xc_1.png" alt="" class="postmark">
            <button class="change">换一换</button>
            <!-- <input type="text" name="title" id="title">
            <input type="text" name="selected_bg1" id="selected_bg1">
            <input type="text" name="selected_bg2" id="selected_bg2">
            <input type="text" name="selected_bg3" id="selected_bg3"> -->
        </div>
        <div class="section">
            <!-- <div class="section_content">祝福语: </div> -->
            <p class="row"></p>
            <p class="row"></p>
            <p class="row"></p>
            <p class="row"></p>
            <!-- <p class="row"></p> -->
            <textarea name="content" id="" cols="30" rows="5" placeholder="请输入祝福语" required></textarea>
        </div>
        <!-- <div class="bg3">
            <span>请选择邮戳</span>
            <ul>
                <li><label for="bg3_1"><img src="image/xc_1.png" alt=""></label><input type="radio" name="selected_bg3" id="bg3_1" value="c_1.png" required></li>
                <li><label for="bg3_2"><img src="image/xc_2.png" alt=""></label><input type="radio" name="selected_bg3" id="bg3_2" value="c_2.png" required></li>
                <li><label for="bg3_3"><img src="image/xc_3.png" alt=""></label><input type="radio" name="selected_bg3" id="bg3_3" value="c_3.png" required></li>
            </ul>
        </div> -->
        <div class="link">
            <label for="checkbox"><input type="checkbox" id="checkbox" checked>发送到良博祝福墙</label>

            <button class="btn finish">完成</button>
            <!-- <button class=".btn submit">发送到祝福墙</button> -->
        </div>
        <!-- <div class="link">
            <input type="submit" value="" class="button">
        </div> -->
    </div>

</body>
<script>
    // 解析正面信息
    var arr = location.search.substr(1).split('&');
    var obj = new Object();
    for (var i = 0; i < arr.length; i++) {
        var tmp_arr = arr[i].split('=')
        obj[decodeURIComponent(tmp_arr[0])] = decodeURIComponent(tmp_arr[1]);
    }
    // 获取元素
    var cultural = document.querySelector('.cultural');
    var postmark = document.querySelector('.postmark');
    var introduce = document.querySelector('.introduce');

    var title = obj['title'];
    var selected_bg1 = obj['selected_bg1'];
    cultural.src = 'image/x' + obj['selected_bg1'];
    postmark.src = 'image/x' + obj['selected_bg3'];

    var culturalID = parseInt(cultural.src.split('.')[0].split('_')[1]);
    // console.log(culturalID + 1);


    // 根据文物显示简介
    switch (culturalID) {
        case 1:
            console.log(1);
            introduce.innerHTML = '玉琮式管<br>反山M20： 87<br>高3 .47 厘米';
            break;
        case 2:
            console.log(2);
            introduce.innerHTML = '龙首纹玉圆牌<br>反山M22：26-1<br>外径4.7-5.4厘米不等';
            break;
        case 3:
            console.log(3);
            introduce.innerHTML = '玉三叉形器<br>瑶山M7：26<br>高4.8厘米';
            break;
        case 4:
            console.log(4);
            introduce.innerHTML = '玉璜<br>反山M23：67<br>高5.75厘米';
            break;
        case 5:
            console.log(5);
            introduce.innerHTML = '玉鸟<br>瑶山M2：50<br>长3.2厘米';
            break;
        case 6:
            console.log(6);
            introduce.innerHTML = '玉鱼<br>反山M22：23<br>长4.83厘米';
            break;
    }
    var recipient = introduce.innerHTML;
    console.log(introduce.innerHTML);

    // 换一换
    var change = document.querySelector('.change');
    var i = 0;
    postmark.addEventListener('click', function() {
        i++;
        if (i == 4) {
            i = 1;
        }
        console.log('image/xc_' + i + '.png');
        postmark.src = 'image/xc_' + i + '.png';
        postmark.style.animation = 'fadein 1.5s';
        postmark.addEventListener("animationend", function() {
            $(this).css("animation", "");
        })

    })


    // 选择加动画
    // var selected = document.getElementsByName("selected_bg3");
    // var bg3 = document.querySelector('.bg3');
    // bg3.addEventListener('click', function() {
    //     for (var i = 0; i < selected.length; i++) {
    //         if (selected[i].checked) {
    //             postmark.src = 'image/x' + selected[i].value;
    //             console.log(postmark.src.split('.')[0].split('_')[1]);

    //             postmark.style.animation = 'fadein 1.5s';
    //             postmark.addEventListener("animationend", function() {
    //                 $(this).css("animation", "");
    //             })


    //         }
    //     }
    // })

    // 提交到服务器
    $(document).ready(function() {
        $(".finish").click(function() {
            var checkbox = document.querySelector('#checkbox');
            var type = checkbox.checked ? 1 : 2;
            console.log("wg", type);
            var textarea = document.querySelector('textarea');


            var content = textarea.value;
            console.log(content);
            var imgUrlId = cultural.src.split('.')[0].split('_')[1] + postmark.src.split('.')[0].split('_')[1];
            console.log(imgUrlId);



            $.post("https://wx.weibenh5.com/2020/Dec/yearCard/api/api.php?a=submits", {
                    title: title,
                    content: content,
                    recipient: recipient,
                    blessing: 's',
                    sender: 's',
                    type: type,
                    img_url_id: imgUrlId,
                },
                function(data, status) {
                    // console.log(data.data.id);
                    window.location.href = "showCover.html?" + 'cardId=' + data.data.id;
                    // alert(alertText);

                });
        });
    });
</script>

</html>