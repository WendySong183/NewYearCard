<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimun-scale=1.0,maximum-scale=1.0,user-scable=no">
    <title>制作（背面）</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/makeReverse.css">
    <script src="js/jquery-3.5.1.min.js"></script>

    </script>
</head>

<body>


    <p class="title">点击更换邮戳</p>

    <div class="beimian">
        <!-- <img src="image/bgbird.png" alt="" class="bird"> -->
        <div class="inherit">
            <img src="image/b_1.png" alt="" class="cultural">
            <img src="image/xc_1.png" alt="" class="postmark">

        </div>
        <div class="section">
            <p class="row"></p>
            <p class="row"></p>
            <p class="row"></p>
            <p class="row"></p>
            <p class="row"></p>
            <textarea name="content" id="" cols="30" rows="5" placeholder="请输入祝福(如新年快乐)" value='新年快乐'></textarea>
        </div>
    </div>
    <div class="link">
        <label for="checkbox"><input type="checkbox" id="checkbox" checked>发送到良博祝福墙</label>

        <button class="btn finish"><img src="image/wancheng.png" alt=""></button>
    </div>


</body>
<script>
    // 解析正面信息
    var arr = location.search.substr(1).split('&');
    var obj = new Object();
    for (var i = 0; i < arr.length; i++) {
        var tmp_arr = arr[i].split('=')
        obj[decodeURIComponent(tmp_arr[0])] = decodeURIComponent(tmp_arr[1]);
    }
    // 获取元素
    var cultural = document.querySelector('.cultural');
    var postmark = document.querySelector('.postmark');

    var lj = obj['lj'];
    var word = obj['word'];
    console.log(parseInt(lj / 10));
    var culturalSrc = 'image/b_' + parseInt(lj / 10) + '.png';
    cultural.src = culturalSrc;

    var postid = 0;
    var postsrc = 'image/xc_1.png';
    $(document).ready(function() {
        // 点击换邮戳
        $('.postmark').click(function() {
            $(this).fadeOut(10)

            postid++;
            if (postid == 4) {
                postid = 1;
            }

            postsrc = 'image/xc_' + postid + '.png';
            console.log(postsrc);

            $(this).attr('src', postsrc).fadeIn(1000);
        })

        // 提交到服务器
        $(".finish").click(function() {
            var checkbox = document.querySelector('#checkbox');
            var type = checkbox.checked ? 1 : 2;
            console.log("wg", type);
            var textarea = document.querySelector('textarea');


            var content = textarea.value;
            if (content == '') {
                content = '新年快乐';
            }
            console.log('c', content);
            var imgUrlId = cultural.src.split('.')[0].split('_')[1] + postmark.src.split('.')[0].split('_')[1];
            // console.log(postsrc);



            $.post("https://wx.weibenh5.com/2020/Dec/yearCard/api/api.php?a=submits", {
                    title: lj,
                    content: content,
                    recipient: '',
                    blessing: word,
                    sender: 's',
                    type: type,
                    img_url_id: postsrc,
                },
                function(data, status) {
                    console.log(data);
                    window.location.href = "showCover.html?" + 'cardId=' + data.data.id;
                    // alert(alertText);

                });
        });
    });
</script>

</html>